
{% macro participant_list(participants) %}
  <ul>
    {% for participant in participants %}
  <li>
       <a href="{{ url_for('profile_view', profile=participant.user.profile.name) }}">  {{ participant.user.fullname }}</a>
  </li>
      {% endfor %}
  </ul>
{% endmacro %}
{% extends "layout.html" %}
{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<div id="main">
  <div class="section row">
    <div class="eventhead span12">  
      <h1> {{ event.title }}</h1>          
      
      <div class="section bar">
        <dl class="bar">
            <dt>When</dt>
            <dd>{{ event.start_datetime | fulldate }} to {{ event.end_datetime | fulldate }}</dd>
            <dt>Where</dt>
            <dd>Bangalore</dd>
            
            {% if event.ticket_price %}
            <dt>Entry Fee</dt>
            <dd>{{ event.ticket_price }} </dd>
            {% endif %}
            
            {% if event.website %}
            <dt>Related Website</dt>
            <dd><a href="{{ event.website }}">{{ event.website }}</a> </dd>
            {% endif %}
        </dl>
      </div>
    
      <div class="section useractions">
       <!--add logic to show one of the following status icons, in the beginning user sees "Register"" -->
       <img class="status" src="{{ url_for('static', filename='img/accepted.png') }}" alt="Registered" title="You're Registered"/>   
	     <img class="status" src="{{ url_for('static', filename='img/rejected.png') }}" alt="Not Accepted" title="Sorry, you've not been accepted"/>
	     <img class="status" src="{{ url_for('static', filename='img/pending.png') }}" alt="Requires Approval" title="Your registration requires approval"/>
	     <img class="status" src="{{ url_for('static', filename='img/withdrawn.png') }}" alt="Withdrawn" title="You've withdrawn your registration "/>
	     <img class="status" src="{{ url_for('static', filename='img/waitlisted.png') }}" alt="Registered" title="You're waitlisted"/>
	     <a href="{{ url_for('event_apply', profile=profile.name, event=event.name) }}" class="btn btn-primary" id="register">Register Now</a>
	     
       <a href="{{ url_for('project_new', profile=profile.name, event=event.name) }}" class="btn btn-primary">Propose a Project</a>
       {% if owner %}
       <a href="{{ url_for('event_open', event=event.name, profile=profile.name) }}" class="btn btn-primary" id="adminactions">Manage</a><!--add conditions for visibility only to admin/creator  -->
       {% endif %}
       <a class="btn btn-danger hidden" href="{{ url_for('event_withdraw', profile=profile.name, event=event.name) }}"  id="withdraw">Withdraw Registration</a>
      </div>

      <p> {{ event.description|safe }} </p>
    </div>
  </div>

  <div class="row">
    <div id="tabs" class="span12">
     {% if projects.count() %}         
              <h2>Project Proposals</h2>
              <table class="table proposals">
                
                <thead>
                  <th>#</th>
                  <th>Title</th>
                  <th>Proposer</th>
                  <th>+1</th>
                  <th>Comments</th>
                  <th>Team members</th>
                  <th>Submitted</th>
                </thead>
                {% for p in projects %}
                <tbody>
                  <tr>
                    <td><a href="{{ url_for('project_show', profile=profile.name ,project=p.name,event=event.name) }}">{{ p.id }}</a></td>
                    <td><a href="{{ url_for('project_show', profile=profile.name ,project=p.name,event=event.name) }}"	><strong>{{ p.title }}</strong></a></td>
                    <td><a href="{{ url_for('project_show', profile=profile.name ,project=p.name,event=event.name) }}">{{ p.members.filter_by(status=0).first().participant.user.fullname }}</a></td>
                    <td><a href="{{ url_for('project_show', profile=profile.name ,project=p.name,event=event.name) }}">{{ p.votes.count }}</a></td>
                    <td><a href="{{ url_for('project_show', profile=profile.name ,project=p.name,event=event.name) }}">{{ p.comments.count }}</a></td>
                    <td><a href="{{ url_for('project_show', profile=profile.name ,project=p.name,event=event.name) }}">{{ p.members.count() }}</a></td>

                    <td><a href="{{ url_for('project_show', profile=profile.name ,project=p.name,event=event.name) }}">{{ p.created_at.strftime("%a, %b %e") }}</a></td>
                  </tr>
                  
                {% endfor %}
                </tbody>
              </table>
     {%- else -%}
      <h2>No projects submitted yet</h2>
     {% endif %}
    </div>
  </div>

  <div class="section row">
    <div class="span12">
      <h2>Registered Participants</h2>
      {{ participant_list(acceptedparticipants) }}
      {{ participant_list(restparticipants) }}
    </div>
  </div>

</div>
{% endblock %}

{% block footerscripts %}
<script>
if({{ applied }})
{
console.log({{ applied }});
  $("#register").addClass("hidden");
  $("#withdraw").removeClass("hidden");
};

if("{{ event.profile.userid }}"=="{{ g.user.userid }}")
{
  $("#register").addClass("hidden");
  $("#withdraw").addClass("hidden");
};

</script>

{% endblock %}
