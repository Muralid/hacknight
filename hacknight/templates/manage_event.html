{% extends "layout.html" %}
{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<div id="main" class="participant-list">

  <h1>Participants</h1>
  <ul class="grid container-fluid">
    <li class="row-fluid header">
      <div class="span2">Name</div>
      <div class="span1">Status</div>
      <div class="span2">Email</div>
      <div class="span4">Reason</div>
      <div class="span2">Phone</div>
      <div class="span2"></div>
  
    </li>
  {% for participant in participants %}
    <li class="row-fluid item participant-{{ participant.id }}" data-status="{{ participant.status }}">
      <div class="span2">{{ participant.user.fullname }}</div>
      <div class="span1 participant-status-label">{{ participant.status | show_participant_status}}</div>
      <div class="span2">{{ participant.email }}</div>
      <div class="span4">{{ participant.reason_to_join|safe }}</div>
      <div class="span2">{{ participant.phone_no }}</div>
<div class="span2">
      <a href="#" class="update-participant-status" data-id="{{ participant.id }}" data-status="2" title="Accept">accept</a> |
      <a href="#" class="update-participant-status" data-id="{{ participant.id }}" data-status="3" title="Reject">reject</a>|
      <a href="#" class="update-participant-status" data-id="{{ participant.id }}" data-status="1" title="Wait-list">wait-list</a>
    </div>
  </li>
  {% endfor %}
</ul>
  </div>

    
{% endblock %}
{% block footerscripts %}
  <script type="text/javascript">
    $(function() {
      $('.update-participant-status').click(function(e) {
        var el = $(this),
            id = el.attr('data-id'),
            participantEl = $('.participant-list .participant-'+id),
            currentStatus = participantEl.attr('data-status'),
            newStatus = el.attr('data-status'),
            statusLabels = {{statuslabels | tojson | safe}};
            if (newStatus == 2)
              $('div#contact-info').html("");
        e.stopPropagation();
        participantEl.children('.participant-status-label').text(statusLabels[newStatus]);
        $.post('manage/update', {participantid: id, status: newStatus})
          .error( function(){ location.reload(); } );
        return false;
      });
    });
  </script>
{% endblock %}